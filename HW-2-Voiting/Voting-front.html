<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voting</title>
</head>

<div id="statistics">
  <h3>Статистика</h3>
  <p data-id="nedzen">Не дзен: </p>
  <p data-id="dzen">Дзен: </p>
  <p data-id="pdzen">Полный дзен: </p>
</div>

<form method=POST action="http://178.172.195.18:7580/vote">
  <p><b>Какое у вас состояние разума?</b></p>
  <div id="radio-block"> </div>
  <p><input type="submit" value="Выбрать"></p>
</form>

<body>
  <script>
    async function getVariantsData() {
      const variantsUrl = `http://178.172.195.18:7580/variants`;
      const votingData = await fetch(variantsUrl)
        .then(response => response.json())
        .then(data => {
          createForm(data);
        })
        .catch((error) => {
          console.log('Request variants failed', error)
        });
    }
    getVariantsData();

    async function createStatData() {
      const statUrl = `http://178.172.195.18:7580/stat`; // http://localhost:7580
      const statData = await fetch(statUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(res => {
          setStatistics(res);
        })
        .catch((error) => {
          console.log('Request stat failed', error)
        });
    }

    createStatData();

    function createForm(formData) {
      const elem = document.getElementById('radio-block');
      for (let i in formData) {
        elem.appendChild(document.createElement("p")).innerHTML =
          `<input name="selection" type="radio" value="${formData[i].id}"> ${formData[i].text}</>`;
      }
    }

    function setStatistics(res) {
      const statisticList = document.querySelectorAll('div#statistics p');
      for (let i in res) {
        if (res[i].id === statisticList[i].dataset.id) {
          statisticList[i].innerText += ` ${res[i].count}`;
        }
      }
    }
  </script>
</body>

</html>